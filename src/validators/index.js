import { curry, isFunction, isObject, isEmpty, hasOwnProperty } from "../utils";

function validateChanges(initial, changes) {
  if (!isObject(changes)) errorHandler("changeType");
  if (Object.keys(changes).some((field) => !hasOwnProperty(initial, field)))
    errorHandler("changeField");

  return changes;
}

function validateSelector(selector) {
  if (!isFunction(selector)) errorHandler("selectorType");
}

function validateHandler(handler) {
  if (!(isFunction(handler) || isObject(handler))) errorHandler("handlerType");
  if (
    isObject(handler) &&
    Object.values(handler).some((_handler) => !isFunction(_handler))
  )
    errorHandler("handlersType");
}

function validateInitial(initial) {
  if (!initial) errorHandler("initialIsRequired");
  if (!isObject(initial)) errorHandler("initialType");
  if (isEmpty(initial)) errorHandler("initialContent");
}

function throwError(errorMessages, type) {
  throw new Error(errorMessages[type] || errorMessages.default);
}

const errorMessages = {
  initialIsRequired: "initial state is required",
  initialType: "initial state should be an object",
  initialContent: "initial state shouldn't be an empty object",
  handlerType: "handler should be an object or a function",
  handlersType: "all handlers should be a functions",
  selectorType: "selector should be a function",
  changeType: "provided value of changes should be an object",
  changeField:
    'it seams you want to change a field in the state which is not specified in the "initial" state',
  default: "an unknown error accured in `statecore-js` package",
};

const errorHandler = curry(throwError)(errorMessages);

const validators = {
  changes: validateChanges,
  selector: validateSelector,
  handler: validateHandler,
  initial: validateInitial,
};

export default validators;

export { errorMessages, errorHandler };
